$(document).ready(function() {
    var newsContentWrap = $(".news-article-content");
    var newsContentSwiper = new Swiper(newsContentWrap, {
        direction: "horizontal",
        simulateTouch: false,
        autoHeight: false,
        speed: 1e3,
        spaceBetween: 0,
        slidesPerView: "auto",
        mousewheel: true,
        keyboard: false,
        navigation: {
            nextEl: ".news-content .news-control-row .news-nav-block .nav-elem.next",
            prevEl: ".news-content .news-control-row .news-nav-block .nav-elem.prev"
        },
        pagination: {
            el: ".news-progress-bar-wrap .track",
            type: "progressbar",
            renderProgressbar: function(progressbarFillClass) {
                return '<div class="track-elem ' + progressbarFillClass + '"></div>'
            }
        },
        on: {
            resize: function() {
                this.update()
            }
        },
        breakpoints: {
            640: {
                direction: "vertical",
                freeMode: true
            }
        }
    });

    function articleScrollPercentage() {
        var articleScrollBlock = $(".article-content-container");
        var articleScrollWrap = $(".article-content-block");
        var scrollPercent = 100 * articleScrollBlock.scrollTop() / (articleScrollWrap.height() - articleScrollBlock.height());
        $(".article-progress-bar-wrap .track .track-elem").css("width", scrollPercent + "%")
    }
    $(".article-content-block").bind("mousewheel", function() {
        articleScrollPercentage()
    });
    var videoDescriptionPlayBtn = ".play-video-btn";
    var videoDescriptionPlayer = $(".article-content-video-wrap .player");
    $(document).on("click", videoDescriptionPlayBtn, function() {
        videoDescriptionPlayer.get(0).play()
    });

    function newsPageState() {
        if (newsContentSwiper.isBeginning == true) {
            setPageState("start")
        }
        if (newsContentSwiper.isEnd == true) {
            setPageState("end")
        }
        if (newsContentSwiper.isBeginning == false && newsContentSwiper.isEnd == false) {
            setPageState("middle")
        }
        if (newsContentSwiper.slides.length <= 4) {
            setPageState("any")
        }
    }
    newsContentSwiper.on("transitionStart", function() {
        mousewheelFactor = false;
        setPageState("middle")
    });
    newsContentSwiper.on("transitionEnd", function() {
        newsPageState();
        setTimeout(function() {
            mousewheelFactor = true
        }, mousewheelFactorOffset)
    });
    $(window).on("hashchange", function() {
        if (getViewState.name() == "news") {
            newsPageState()
        }
    })
});
